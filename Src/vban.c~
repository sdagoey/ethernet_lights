# include "vban.h"

struct vban_packet parse_vban_packet(char *ptr){
    struct vban_packet parsed_packet;
    memcpy(&parsed_packet.vban,ptr+HEADER_OFFSET,4);
    memcpy(&parsed_packet.format_sr,ptr+SR_OFFSET,1);
    memcpy(&parsed_packet.format_nbs,ptr+NBS_OFFSET,1);
    memcpy(&parsed_packet.format_nbc,ptr+NBS_OFFSET,1);
    memcpy(&parsed_packet.format_bit,ptr+NBS_OFFSET,1);
    memcpy(&parsed_packet.streamname,ptr+STREAMNAME_OFFSET,16);
    memcpy(&parsed_packet.nuFrame,ptr+FRAME_OFFSET,4);
    //memcpy(&parsed_packet.payload,ptr+PAYLOAD_START,512);
    for(uint16_t i = 0; i < 255; i++){
    	uint16_t temp;
    	uint8_t temp0;
    	uint8_t temp1;
    	temp0 = ptr[PAYLOAD_START+2*i];
    	temp1 = ptr[PAYLOAD_START+2*i+1];
    	temp = temp0 <<8 + temp1;
    	//temp = (ptr[PAYLOAD_START*2*i] << 8 | ptr[PAYLOAD_START+2*i+1]);
//    	if (temp < 32768){
//    		temp += 32768;
//    	}
//		else{
//			if(temp > 32768){
//				temp -= 32768;
//			}
//
//		}
    	parsed_packet.payload[i] = temp * hamming_window_256[i];
    	//parsed_packet.payload[i] = temp / 65536.0 * hamming_window_256[i];
    }
//    udp_scratch_send(parsed_packet.payload,256);
    return parsed_packet;
}

float32_t hamming_window_256[256] = {
		   0.080000,
		   0.080140,
		   0.080558,
		   0.081256,
		   0.082232,
		   0.083487,
		   0.085018,
		   0.086825,
		   0.088908,
		   0.091264,
		   0.093893,
		   0.096793,
		   0.099962,
		   0.103398,
		   0.107099,
		   0.111063,
		   0.115287,
		   0.119769,
		   0.124506,
		   0.129496,
		   0.134734,
		   0.140219,
		   0.145946,
		   0.151913,
		   0.158115,
		   0.164549,
		   0.171211,
		   0.178097,
		   0.185203,
		   0.192524,
		   0.200056,
		   0.207794,
		   0.215734,
		   0.223871,
		   0.232200,
		   0.240716,
		   0.249413,
		   0.258287,
		   0.267332,
		   0.276542,
		   0.285912,
		   0.295437,
		   0.305110,
		   0.314925,
		   0.324878,
		   0.334960,
		   0.345168,
		   0.355493,
		   0.365931,
		   0.376474,
		   0.387117,
		   0.397852,
		   0.408674,
		   0.419575,
		   0.430550,
		   0.441591,
		   0.452691,
		   0.463845,
		   0.475045,
		   0.486285,
		   0.497557,
		   0.508854,
		   0.520171,
		   0.531500,
		   0.542834,
		   0.554166,
		   0.565489,
		   0.576797,
		   0.588083,
		   0.599340,
		   0.610560,
		   0.621738,
		   0.632866,
		   0.643938,
		   0.654946,
		   0.665885,
		   0.676747,
		   0.687527,
		   0.698217,
		   0.708810,
		   0.719302,
		   0.729684,
		   0.739951,
		   0.750097,
		   0.760115,
		   0.770000,
		   0.779745,
		   0.789345,
		   0.798793,
		   0.808084,
		   0.817212,
		   0.826172,
		   0.834958,
		   0.843565,
		   0.851988,
		   0.860222,
		   0.868261,
		   0.876100,
		   0.883736,
		   0.891163,
		   0.898377,
		   0.905373,
		   0.912148,
		   0.918696,
		   0.925015,
		   0.931100,
		   0.936947,
		   0.942554,
		   0.947916,
		   0.953030,
		   0.957894,
		   0.962504,
		   0.966858,
		   0.970952,
		   0.974785,
		   0.978353,
		   0.981656,
		   0.984690,
		   0.987455,
		   0.989948,
		   0.992168,
		   0.994113,
		   0.995782,
		   0.997175,
		   0.998290,
		   0.999128,
		   0.999686,
		   0.999965,
		   0.999965,
		   0.999686,
		   0.999128,
		   0.998290,
		   0.997175,
		   0.995782,
		   0.994113,
		   0.992168,
		   0.989948,
		   0.987455,
		   0.984690,
		   0.981656,
		   0.978353,
		   0.974785,
		   0.970952,
		   0.966858,
		   0.962504,
		   0.957894,
		   0.953030,
		   0.947916,
		   0.942554,
		   0.936947,
		   0.931100,
		   0.925015,
		   0.918696,
		   0.912148,
		   0.905373,
		   0.898377,
		   0.891163,
		   0.883736,
		   0.876100,
		   0.868261,
		   0.860222,
		   0.851988,
		   0.843565,
		   0.834958,
		   0.826172,
		   0.817212,
		   0.808084,
		   0.798793,
		   0.789345,
		   0.779745,
		   0.770000,
		   0.760115,
		   0.750097,
		   0.739951,
		   0.729684,
		   0.719302,
		   0.708810,
		   0.698217,
		   0.687527,
		   0.676747,
		   0.665885,
		   0.654946,
		   0.643938,
		   0.632866,
		   0.621738,
		   0.610560,
		   0.599340,
		   0.588083,
		   0.576797,
		   0.565489,
		   0.554166,
		   0.542834,
		   0.531500,
		   0.520171,
		   0.508854,
		   0.497557,
		   0.486285,
		   0.475045,
		   0.463845,
		   0.452691,
		   0.441591,
		   0.430550,
		   0.419575,
		   0.408674,
		   0.397852,
		   0.387117,
		   0.376474,
		   0.365931,
		   0.355493,
		   0.345168,
		   0.334960,
		   0.324878,
		   0.314925,
		   0.305110,
		   0.295437,
		   0.285912,
		   0.276542,
		   0.267332,
		   0.258287,
		   0.249413,
		   0.240716,
		   0.232200,
		   0.223871,
		   0.215734,
		   0.207794,
		   0.200056,
		   0.192524,
		   0.185203,
		   0.178097,
		   0.171211,
		   0.164549,
		   0.158115,
		   0.151913,
		   0.145946,
		   0.140219,
		   0.134734,
		   0.129496,
		   0.124506,
		   0.119769,
		   0.115287,
		   0.111063,
		   0.107099,
		   0.103398,
		   0.099962,
		   0.096793,
		   0.093893,
		   0.091264,
		   0.088908,
		   0.086825,
		   0.085018,
		   0.083487,
		   0.082232,
		   0.081256,
		   0.080558,
		   0.080140,
		   0.080000
};

float32_t hanning_window_256[256] = {
		   0.00000
		   0.00015
		   0.00061
		   0.00137
		   0.00243
		   0.00379
		   0.00545
		   0.00742
		   0.00968
		   0.01224
		   0.01510
		   0.01825
		   0.02170
		   0.02543
		   0.02946
		   0.03376
		   0.03836
		   0.04323
		   0.04838
		   0.05380
		   0.05949
		   0.06546
		   0.07168
		   0.07817
		   0.08491
		   0.09190
		   0.09914
		   0.10663
		   0.11435
		   0.12231
		   0.13050
		   0.13891
		   0.14754
		   0.15638
		   0.16543
		   0.17469
		   0.18414
		   0.19379
		   0.20362
		   0.21363
		   0.22382
		   0.23417
		   0.24468
		   0.25535
		   0.26617
		   0.27713
		   0.28823
		   0.29945
		   0.31079
		   0.32225
		   0.33382
		   0.34549
		   0.35725
		   0.36910
		   0.38103
		   0.39303
		   0.40510
		   0.41722
		   0.42940
		   0.44161
		   0.45387
		   0.46615
		   0.47845
		   0.49076
		   0.50308
		   0.51540
		   0.52771
		   0.54000
		   0.55226
		   0.56450
		   0.57670
		   0.58885
		   0.60094
		   0.61298
		   0.62494
		   0.63683
		   0.64864
		   0.66036
		   0.67197
		   0.68349
		   0.69489
		   0.70618
		   0.71734
		   0.72837
		   0.73926
		   0.75000
		   0.76059
		   0.77103
		   0.78130
		   0.79140
		   0.80132
		   0.81106
		   0.82061
		   0.82996
		   0.83912
		   0.84807
		   0.85681
		   0.86533
		   0.87363
		   0.88170
		   0.88954
		   0.89714
		   0.90451
		   0.91163
		   0.91849
		   0.92511
		   0.93146
		   0.93756
		   0.94339
		   0.94895
		   0.95423
		   0.95924
		   0.96398
		   0.96843
		   0.97259
		   0.97647
		   0.98006
		   0.98336
		   0.98636
		   0.98907
		   0.99149
		   0.99360
		   0.99542
		   0.99693
		   0.99814
		   0.99905
		   0.99966
		   0.99996
		   0.99996
		   0.99966
		   0.99905
		   0.99814
		   0.99693
		   0.99542
		   0.99360
		   0.99149
		   0.98907
		   0.98636
		   0.98336
		   0.98006
		   0.97647
		   0.97259
		   0.96843
		   0.96398
		   0.95924
		   0.95423
		   0.94895
		   0.94339
		   0.93756
		   0.93146
		   0.92511
		   0.91849
		   0.91163
		   0.90451
		   0.89714
		   0.88954
		   0.88170
		   0.87363
		   0.86533
		   0.85681
		   0.84807
		   0.83912
		   0.82996
		   0.82061
		   0.81106
		   0.80132
		   0.79140
		   0.78130
		   0.77103
		   0.76059
		   0.75000
		   0.73926
		   0.72837
		   0.71734
		   0.70618
		   0.69489
		   0.68349
		   0.67197
		   0.66036
		   0.64864
		   0.63683
		   0.62494
		   0.61298
		   0.60094
		   0.58885
		   0.57670
		   0.56450
		   0.55226
		   0.54000
		   0.52771
		   0.51540
		   0.50308
		   0.49076
		   0.47845
		   0.46615
		   0.45387
		   0.44161
		   0.42940
		   0.41722
		   0.40510
		   0.39303
		   0.38103
		   0.36910
		   0.35725
		   0.34549
		   0.33382
		   0.32225
		   0.31079
		   0.29945
		   0.28823
		   0.27713
		   0.26617
		   0.25535
		   0.24468
		   0.23417
		   0.22382
		   0.21363
		   0.20362
		   0.19379
		   0.18414
		   0.17469
		   0.16543
		   0.15638
		   0.14754
		   0.13891
		   0.13050
		   0.12231
		   0.11435
		   0.10663
		   0.09914
		   0.09190
		   0.08491
		   0.07817
		   0.07168
		   0.06546
		   0.05949
		   0.05380
		   0.04838
		   0.04323
		   0.03836
		   0.03376
		   0.02946
		   0.02543
		   0.02170
		   0.01825
		   0.01510
		   0.01224
		   0.00968
		   0.00742
		   0.00545,
		   0.00379,
		   0.00243,
		   0.00137,
		   0.00061,
		   0.00015,
		   0.00000,
};
};
